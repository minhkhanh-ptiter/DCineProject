<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>D-cine | Hồ sơ của tôi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Core CSS giống movie-detail -->
    <link rel="stylesheet" href="../assets/css/variable.css?v=8">
    <link rel="stylesheet" href="../assets/css/base.css?v=8">
    <link rel="stylesheet" href="../assets/css/layout.css?v=8">
    <link rel="stylesheet" href="../assets/css/header.css?v=8">
    <link rel="stylesheet" href="../assets/css/main.css?v=8">
    <link rel="stylesheet" href="../assets/css/components.css?v=8">
    <link rel="stylesheet" href="../assets/css/footer.css?v=9">

    <!-- CSS riêng cho trang Profile -->
    <link rel="stylesheet" href="../assets/css/profile.css?v=1">

    <!-- Font & icon (cho avatar, icon vé, shield, ticket, v.v.) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- QRCode lib cho popup vé -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
</head>

<body class="page-profile">
    <!-- Header chung -->
    <div id="hdr-include"></div>

    <main class="profile-page">
        <div class="profile-page__inner">
            <!-- ====== HEADER HỒ SƠ ====== -->
            <div class="profile-header-card">
                <div class="avatar-wrapper">
                    <div class="avatar-frame">
                        <img src="..." alt="Avatar" id="user-avatar">
                    </div>
                    
                    <label for="avatar-input" class="btn-edit-avatar" title="Đổi ảnh đại diện">
                        <i class="fa-solid fa-camera"></i>
                    </label>
                    <input type="file" id="avatar-input" accept="image/*" hidden>
                </div>


                <div class="user-summary">
                    <h2 id="display-name">Loading...</h2>
                    <div class="user-handle" id="display-username">@loading</div>

                    <div id="display-badge" class="badge-tier tier-Standard">...</div>

                    <div class="membership-progress">
                        <div class="progress-info">
                            <span>Chi tiêu: <b id="curr-spend" style="color:#fff">0đ</b></span>
                            <span>Mục tiêu: <b id="next-tier-spend" style="color:var(--accent-gold)">...</b></span>
                        </div>
                        <div class="progress-bg">
                            <div id="tier-progress" class="progress-fill"></div>
                        </div>
                        <div id="tier-msg" class="tier-msg">Đang tải dữ liệu hạng...</div>
                    </div>
                </div>

                <button class="btn-logout" onclick="logout()">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span class="hide-mobile">Đăng xuất</span>
                </button>
            </div>

            <!-- ====== NAV TAB ====== -->
            <div class="nav-tabs">
                <button class="nav-item active" onclick="switchTab('info', this)">
                    <i class="fa-regular fa-id-card"></i> Hồ sơ
                </button>
                <button class="nav-item" onclick="switchTab('tickets', this)">
                    <i class="fa-solid fa-ticket"></i> Vé của tôi
                </button>
                <button class="nav-item" onclick="switchTab('promos', this)">
                    <i class="fa-solid fa-gift"></i> Ưu đãi
                </button>
                <button class="nav-item" onclick="switchTab('security', this)">
                    <i class="fa-solid fa-shield-halved"></i> Bảo mật
                </button>
            </div>

            <div class="tab-container">
                <!-- ====== TAB 1: HỒ SƠ ====== -->
                <div id="tab-info" class="tab-pane active">
                    <div class="info-form">
                        <div class="info-form__header">
                            <h3>Thông tin chi tiết</h3>
                            <button id="btn-edit" class="btn-edit" onclick="toggleEdit()">
                                <i class="fa-solid fa-pen"></i> Sửa
                            </button>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Họ và tên</label>
                                <input id="inp-name" class="form-input" type="text" disabled>
                            </div>
                            <div class="form-group">
                                <label>Username</label>
                                <input id="inp-username" class="form-input" type="text" disabled>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input id="inp-email" class="form-input" type="email" disabled>
                            </div>
                            <div class="form-group">
                                <label>Số điện thoại</label>
                                <input id="inp-phone" class="form-input" type="tel" disabled>
                            </div>
                            <div class="form-group">
                                <label>Ngày sinh</label>
                                <input id="inp-dob" class="form-input" type="date" disabled>
                            </div>
                            <div class="form-group">
                                <label>Giới tính</label>
                                <select id="inp-gender" class="form-input" disabled>
                                    <option value="MALE">Nam</option>
                                    <option value="FEMALE">Nữ</option>
                                    <option value="OTHER">Khác</option>
                                </select>
                            </div>
                            <div class="form-group form-group--full">
                                <label>Địa chỉ</label>
                                <input id="inp-address" class="form-input" type="text" disabled>
                            </div>
                            <div class="form-group form-group--full">
                                <label>Ngày tham gia</label>
                                <input id="inp-joined" class="form-input" type="text" disabled>
                            </div>
                        </div>

                        <div id="edit-actions" class="edit-actions">
                            <button class="btn-primary" onclick="saveProfile()">
                                Lưu thay đổi
                            </button>
                            <button class="btn-ghost" onclick="toggleEdit()">
                                Hủy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ====== TAB 2: VÉ CỦA TÔI ====== -->
                <div id="tab-tickets" class="tab-pane">
                    <div class="ticket-section-title">VÉ SẮP CHIẾU</div>
                    <div id="active-tickets" class="ticket-list">
                        <div class="st-loading">Đang tải vé...</div>
                    </div>

                    <div class="ticket-section-title" style="margin-top:30px;">LỊCH SỬ VÉ</div>
                    <div id="past-tickets" class="ticket-list">
                        <div class="st-loading">Đang tải lịch sử...</div>
                    </div>
                </div>

                <!-- ====== TAB 3: ƯU ĐÃI ====== -->
                <div id="tab-promos" class="tab-pane">
                    <div class="ticket-section-title">ƯU ĐÃI DÀNH RIÊNG CHO BẠN</div>
                    <div id="promo-list" class="promo-grid">
                        <!-- renderPromos() -->
                    </div>
                </div>

                <!-- ====== TAB 4: BẢO MẬT ====== -->
                <div id="tab-security" class="tab-pane">
                    <div class="info-form">
                        <div class="info-form__header">
                            <h3><i class="fa-solid fa-key"></i> Đổi mật khẩu</h3>
                        </div>
                        <div class="form-grid form-grid--single">
                            <div class="form-group">
                                <label>Mật khẩu hiện tại</label>
                                <input id="old-pass" type="password" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Mật khẩu mới</label>
                                <input id="new-pass" type="password" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Nhập lại mật khẩu mới</label>
                                <input id="confirm-pass" type="password" class="form-input">
                            </div>
                        </div>
                        <div class="edit-actions">
                            <button class="btn-primary" onclick="changePassword()">Cập nhật mật khẩu</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ====== MODAL QR VÉ ====== -->
            <div id="qrModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeModal()">&times;</span>
                    <h3 class="modal-title">MÃ VÉ VÀO RẠP</h3>
                    <div id="qrcode" class="qrcode-box"></div>
                    <p class="modal-ticket-code" id="modal-ticket-code">...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer chung -->
    <div id="ftr-include"></div>

    <!-- API base + core JS giống movie-detail -->
    <script>window.API_BASE = window.API_BASE || '/api';</script>
    <script src="../assets/js/main.js" defer></script>
    <script src="../assets/js/profile.js" defer></script>
    <script src="../assets/js/footer.js" defer></script>
</body>
</html>
